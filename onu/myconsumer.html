<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/stylesheet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="./css/mypage.css">

    <title></title>
  </head>
  <body>
    <header>
      <nav id="header" class="navbar navbar-expand-lg navbar-dark fixed-top">
        <a class="navbar-brand" href="./index.html">
          <img src="./img/logo.png" width="30" height="30" class="d-inline-block align-top" alt="">
          공앤유
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav justify-content-end">
            <li class="nav-item active">
              <a id = "signup_hi" class="nav-link" href="signup.html">회원가입</a>
            </li>
            <li class="nav-item active">
              <a id = "login_logout" class="nav-link" href="#" data-toggle="modal" data-target=".bd-example-modal-lg" data-whatever="login">로그인</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <div class="main-header">
      <div class="container main-container">
        <h1 id="status">나의 견적서</h1>
        <hr>
        <div class = "signup_form">
          <div class="placeInfo">
            <div class="infoUnit">
              공간유형<br>
              <input id="info0"type="text" name="" value=""class="infoInput" disabled>
            </div>
            <div class="infoUnit">
              지역<br>
              <input id="info1"type="text" name="" value=""class="infoInput" disabled>
            </div>
            <div class="infoUnit">
              인원<br>
              <input id="info2"type="text" name="" value=""class="infoInput" disabled>
            </div>
            <div class="infoUnit">
              날짜<br>
              <input id="info3"type="text" name="" value=""class="infoInput" disabled>
            </div>
            <a href="./confirm.html">
              <button id="btn_next"type="button" class="btn btn_gray" style="display:inline">견 적 확 인 하 기</button>
            </a>
            <a href="./index.html">
              <button id="btn_next"type="button" class="btn btn_gray" style="display:inline">홈 으 로</button>
            </a>
          </div>
        </div>
      </div>
    </div>
  </body>
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyB5Aji_Ysf6EsI_6cR4kDs3yi9s0bjo9_k",
      authDomain: "andu-3f6db.firebaseapp.com",
      databaseURL: "https://andu-3f6db.firebaseio.com",
      projectId: "andu-3f6db",
      storageBucket: "andu-3f6db.appspot.com",
      messagingSenderId: "799401536592"
    };
    firebase.initializeApp(config);
    var authdata;

    // Get a reference to the database service
    var database = firebase.database();
    // Get a reference to the storage service, which is used to create references in your storage bucket
    var storage = firebase.storage();
    // Create a root reference
    var storageRef = firebase.storage().ref();

    $(window).ready(function() {
      var ref = firebase.database().ref('type');
      var content = "현재까지 등록된 공간 수는 ";

      ref.once('value').then(function(snapshot) {

        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            authdata = user;
            document.getElementById('signup_hi').innerHTML = authdata.email + "님 환영합니다.";
            document.getElementById('login_logout').innerHTML = "로그아웃";
            updateContract();
          }
          else {
           authdata = null;
           document.getElementById('signup_hi').innerHTML = "회원가입";
           document.getElementById('login_logout').innerHTML = "로그인";
          }
        });
      });
    });

    function updateContract(){
      var data = firebase.database().ref('contract/');
      data.once('value').then(function(snapshot){
        var randomList = snapshot.val();
        var randomKey = Object.keys(snapshot.val());
        console.log(authdata.uid);
        for (var i = 0; i < randomKey.length; i++) {
          if (authdata.uid == randomKey[i]) {
            // consumer
            document.getElementById("info0").value = randomList[randomKey[i]].type;
            document.getElementById("info1").value = randomList[randomKey[i]].place;
            document.getElementById("info2").value = randomList[randomKey[i]].number;
            document.getElementById("info3").value = randomList[randomKey[i]].date;
          }
        }
        // provider
      });
    }

    function get_currentUser(){
      return firebase.auth().currentUser;
    }

  </script>
</html>
