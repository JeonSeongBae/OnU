<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
      <!-- 파일 업로드 -->
      <input type="file" id="file" name="file">
      <button type="button" name="button" onclick="fileUp()"></button>
  </body>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDxbF57tRwkq5bdMyMPLbG5o9MfhfAHKmg",
      authDomain: "andu-temp.firebaseapp.com",
      databaseURL: "https://andu-temp.firebaseio.com",
      projectId: "andu-temp",
      storageBucket: "andu-temp.appspot.com",
      messagingSenderId: "110005684913"
    };
    firebase.initializeApp(config);

    // Get a reference to the database service
    var database = firebase.database();
    // Get a reference to the storage service, which is used to create references in your storage bucket
    var storage = firebase.storage();
    // Create a root reference
    var storageRef = firebase.storage().ref();

    function fileUp(){
      //파일 업로드
      // File or Blob named mountains.jpg
      var file = document.getElementById("file").files[0];

      // Create the file metadata
      // var metadata = {
      //   contentType: 'image/jpeg'
      // };

      var uploadTask = storageRef.child('images/' + file.name).put(file);
      // var uploadTask = storageRef.child('images/' + file.name).put(file, metadata);

      // Listen for state changes, errors, and completion of the upload.
      uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
        function(snapshot) {
          // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
          var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          console.log('Upload is ' + progress + '% done');
          switch (snapshot.state) {
            case firebase.storage.TaskState.PAUSED: // or 'paused'
              console.log('Upload is paused');
              break;
            case firebase.storage.TaskState.RUNNING: // or 'running'
              console.log('Upload is running');
              break;
          }
        }, function(error) {
        switch (error.code) {
          case 'storage/unauthorized':
            // User doesn't have permission to access the object
            break;

          case 'storage/canceled':
            // User canceled the upload
            break;

          case 'storage/unknown':
            // Unknown error occurred, inspect error.serverResponse
            break;
        }
      }, function() {
        // Upload completed successfully, now we can get the download URL
        var downloadURL = uploadTask.snapshot.downloadURL;
      });
    }

  </script>
</html>
